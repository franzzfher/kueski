version: 2

models:
  - name: stg_loans
    description: "cleaned loan snapshots with status history"
    columns:
      - name: _unique_id
        description: "surrogate primary key (hash of loan_id + limit_month)"
        tests:
          - unique
          - not_null
      - name: loan_id
        description: "unique loan identifier"
        tests:
          - not_null
      - name: user_id
        description: "foreign key to customer"
        tests:
          - not_null
          # Note: relationships test might fail if loans exist for missing users in raw data
          # - relationships:
          #     to: ref('stg_customers')
          #     field: user_id

  - name: stg_repays
    description: "cleaned repayment transactions"
    columns:
      - name: repayment_id
        description: "primary key"
        tests:
          - unique
          - not_null
      - name: loan_id
        description: "foreign key to loan"
        tests:
          - not_null
          - relationships:
              to: ref('stg_loans')
              field: loan_id
      - name: user_id
        description: "foreign key to customer"
        tests:
          - not_null
          - relationships:
              to: ref('stg_customers')
              field: user_id

  - name: stg_customers
    description: "cleaned customer dimension"
    columns:
      - name: user_id
        description: "primary key"
        tests:
          - unique
          - not_null
